<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تقویم فارسی هوشمند</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="gps-test/js/jalaali.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;400;700&display=swap');
        body { font-family: 'Vazirmatn', sans-serif; background-color: #f3f4f6; }
        .holiday { color: #ef4444 !important; font-weight: bold; }
    </style>
</head>
<body class="p-5 flex justify-center items-center min-screen">

    <div class="bg-white shadow-2xl rounded-2xl p-6 w-full max-w-md">
        <div class="flex justify-between items-center mb-6">
            <button onclick="changeMonth(-1)" class="p-2 hover:bg-gray-100 rounded-full transition">◀</button>
            <h2 id="monthTitle" class="text-xl font-bold text-gray-800"></h2>
            <button onclick="changeMonth(1)" class="p-2 hover:bg-gray-100 rounded-full transition">▶</button>
        </div>

        <div class="grid grid-cols-7 mb-2 border-b pb-2 text-gray-500 text-sm">
            <div class="text-center">ش</div>
            <div class="text-center">ی</div>
            <div class="text-center">د</div>
            <div class="text-center">س</div>
            <div class="text-center">چ</div>
            <div class="text-center">پ</div>
            <div class="text-center text-red-500">ج</div>
        </div>

        <div id="daysGrid" class="grid grid-cols-7 gap-2"></div>

        <div class="mt-6 p-4 bg-blue-50 rounded-lg">
            <h3 class="text-sm font-bold text-blue-800 mb-2">مناسبت‌های این ماه:</h3>
            <ul id="eventList" class="text-xs text-blue-700 space-y-1"></ul>
        </div>
    </div>

    <script>
        let currentMonthOffset = 0;

        // دیتابیس نمونه برای مناسبت‌های ثابت (برای داینامیک بودن باید از API استفاده شود)
        const staticEvents = {
            "1-1": "عید نوروز",
            "1-12": "روز جمهوری اسلامی",
            "1-13": "روز طبیعت",
            "4-10": "جشن تیرگان",
            "10-1": "جشن دیگان",
            "12-29": "ملی شدن صنعت نفت"
        };

        function renderCalendar() {
            const now = new Date();
            const todayJ = jalaali.toJalaali(now);
            
            let targetMonth = todayJ.jm + currentMonthOffset;
            let targetYear = todayJ.jy;

            // مدیریت تغییر سال هنگام جابجایی ماه
            while (targetMonth > 12) { targetMonth -= 12; targetYear++; }
            while (targetMonth < 1) { targetMonth += 12; targetYear--; }

            const monthNames = ["فروردین", "اردیبهشت", "خرداد", "تیر", "مرداد", "شهریور", "مهر", "آبان", "آذر", "دی", "بهمن", "اسفند"];
            document.getElementById('monthTitle').innerText = `${monthNames[targetMonth - 1]} ${targetYear}`;

            const daysInMonth = jalaali.jalaaliMonthLength(targetYear, targetMonth);
            const firstDayDetails = jalaali.jalCal(targetYear);
            
            // پیدا کردن روز هفته‌ی اولین روز ماه
            const firstDayOfMonthG = jalaali.toGregorian(targetYear, targetMonth, 1);
            const firstDayDate = new Date(firstDayOfMonthG.gy, firstDayOfMonthG.gm - 1, firstDayOfMonthG.gd);
            let startDayOfWeek = (firstDayDate.getDay() + 1) % 7; // تبدیل به شنبه‌محور

            const grid = document.getElementById('daysGrid');
            grid.innerHTML = '';
            const eventList = document.getElementById('eventList');
            eventList.innerHTML = '';

            // ایجاد فضاهای خالی برای شروع ماه
            for (let i = 0; i < startDayOfWeek; i++) {
                grid.innerHTML += `<div class="h-10"></div>`;
            }

            // ساخت روزها
            for (let d = 1; d <= daysInMonth; d++) {
                const isToday = d === todayJ.jd && targetMonth === todayJ.jm && targetYear === todayJ.jy;
                const isFriday = (startDayOfWeek + d - 1) % 7 === 6;
                const eventKey = `${targetMonth}-${d}`;
                const hasEvent = staticEvents[eventKey];

                if (hasEvent) {
                    eventList.innerHTML += `<li>• ${d} ${monthNames[targetMonth-1]}: ${hasEvent}</li>`;
                }

                grid.innerHTML += `
                    <div class="h-10 flex items-center justify-center rounded-lg cursor-pointer transition 
                        ${isToday ? 'bg-blue-600 text-white font-bold' : 'hover:bg-gray-100'} 
                        ${isFriday || hasEvent ? 'text-red-500' : 'text-gray-700'}">
                        ${d}
                    </div>`;
            }
        }

        function changeMonth(step) {
            currentMonthOffset += step;
            renderCalendar();
        }

        renderCalendar();
    </script>
</body>
</html>
